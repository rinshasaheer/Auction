<<<<<<< HEAD
// Load modules

var Crypto = require('crypto');
var Boom = require('boom');
=======
'use strict';

// Load modules

const Crypto = require('crypto');
const Boom = require('boom');
>>>>>>> 1e102df0168f9310e6b81c200a62bf55ccdd58a7


// Declare internals

<<<<<<< HEAD
var internals = {};
=======
const internals = {};
>>>>>>> 1e102df0168f9310e6b81c200a62bf55ccdd58a7


// Generate a cryptographically strong pseudo-random data

exports.randomString = function (size) {

<<<<<<< HEAD
    var buffer = exports.randomBits((size + 1) * 6);
=======
    const buffer = exports.randomBits((size + 1) * 6);
>>>>>>> 1e102df0168f9310e6b81c200a62bf55ccdd58a7
    if (buffer instanceof Error) {
        return buffer;
    }

<<<<<<< HEAD
    var string = buffer.toString('base64').replace(/\+/g, '-').replace(/\//g, '_').replace(/\=/g, '');
=======
    const string = buffer.toString('base64').replace(/\+/g, '-').replace(/\//g, '_').replace(/\=/g, '');
>>>>>>> 1e102df0168f9310e6b81c200a62bf55ccdd58a7
    return string.slice(0, size);
};


<<<<<<< HEAD
=======
// Return a random string of digits

exports.randomDigits = function (size) {

    const buffer = exports.randomBits(size * 8);
    if (buffer instanceof Error) {
        return buffer;
    }

    const digits = [];
    for (let i = 0; i < buffer.length; ++i) {
        digits.push(Math.floor(buffer[i] / 25.6));
    }

    return digits.join('');
};


// Generate a buffer of random bits

>>>>>>> 1e102df0168f9310e6b81c200a62bf55ccdd58a7
exports.randomBits = function (bits) {

    if (!bits ||
        bits < 0) {

        return Boom.internal('Invalid random bits count');
    }

<<<<<<< HEAD
    var bytes = Math.ceil(bits / 8);
=======
    const bytes = Math.ceil(bits / 8);
>>>>>>> 1e102df0168f9310e6b81c200a62bf55ccdd58a7
    try {
        return Crypto.randomBytes(bytes);
    }
    catch (err) {
        return Boom.internal('Failed generating random bits: ' + err.message);
    }
};


// Compare two strings using fixed time algorithm (to prevent time-based analysis of MAC digest match)

exports.fixedTimeComparison = function (a, b) {

    if (typeof a !== 'string' ||
        typeof b !== 'string') {

        return false;
    }

<<<<<<< HEAD
    var mismatch = (a.length === b.length ? 0 : 1);
=======
    let mismatch = (a.length === b.length ? 0 : 1);
>>>>>>> 1e102df0168f9310e6b81c200a62bf55ccdd58a7
    if (mismatch) {
        b = a;
    }

<<<<<<< HEAD
    for (var i = 0, il = a.length; i < il; ++i) {
        var ac = a.charCodeAt(i);
        var bc = b.charCodeAt(i);
=======
    for (let i = 0; i < a.length; ++i) {
        const ac = a.charCodeAt(i);
        const bc = b.charCodeAt(i);
>>>>>>> 1e102df0168f9310e6b81c200a62bf55ccdd58a7
        mismatch |= (ac ^ bc);
    }

    return (mismatch === 0);
};
<<<<<<< HEAD


=======
>>>>>>> 1e102df0168f9310e6b81c200a62bf55ccdd58a7
